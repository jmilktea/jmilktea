## 系统负载 
**命令：top**   
描述：top 可以查看机器负载情况，在排查问题的时候经常会用到  
![image](https://github.com/jmilktea/jmilktea/blob/master/linux/images/top.png)  
输出概要信息包含**系统信息**，**进程信息**，**cpu信息**，**物理内存信息**，**交换区内存信息**：  
**top**：09:44:56 [当前系统时间], 16 days[系统已经运行了16天], 1 user[个用户当前登录], load average: 9.59, 4.75, 1.92[系统负载，即任务队列的平均长度]  
**Tasks**: 145 total[总进程数], 2 running[正在运行的进程数], 143 sleeping[睡眠的进程数], 0 stopped[停止的进程数], 0 zombie[冻结进程数]    
**Cpu(s)**: 99.8%us[用户空间占用CPU百分比], 0.1%sy[内核空间占用CPU百分比], 0.0%ni[用户进程空间内改变过优先级的进程占用CPU百分比], 0.2%id[空闲CPU百分比], 0.0%wa[等待输入输出的CPU时间百分比], 0.0%hi[], 0.0%st[]    
**Mem**: 4147888k total[物理内存总量], 2493092k used[使用的物理内存总量], 1654796k free[空闲内存总量], 158188k buffers[用作内核缓存的内存量]  
**Swap**: 5144568k total[交换区总量],56k used[使用的交换区总量],5144512k free[空闲交换区总量],2013180k cached[缓冲的交换区总量]
- 操作
  - 按下P控制台会按照%CPU排序
  - 按下M则会按照内存排序
  - 按下q则退出
  - 使用-p 参数可以查看指定进程  
  如 top -p 8963查看java进程的使用情况
- htop   
需要安装，更方便，强大一些

## 磁盘/目录
**命令：df(disk free)，du（disk usage）**
- df 查看磁盘使用情况  
df -h：-h表示以可读形式输出，例如1G,200M代替字节输出如下：  
![image](https://github.com/jmilktea/jmilktea/blob/master/linux/images/df.png)  
**Filesystem**:表示文件系统名称  **Size**:大小  **Used**:已用大小  **Avail**:可用空间  **Use**%:已用百分比  **Mounted on**:挂载点  
从上面可以看到vda1这个盘挂载在/根目录下，并且已用100%，没有剩余空间了

- du 查看目录文件使用情况  
  - **查看某个文件或目录大小：du -h 目录/文件名**  
  没有写文件名则表示当前目录    
  
  - **查看当前目录下所有目录大小：du -sh \***   
  -s表示汇总，而不输出子目录    
  
  - **查看当前所有目录大小并排序：du -sh * | sort -h**   
  sort -h表示依照可读大小排序   
  
  - **查看当前目录下最大的10个目录：du -sh * | sort -rh | head -n 10 或者 du -sh * | sort -h | tail -n 10**    
  sort -r表示倒序，head -n 取前n个  
  
  - **查看占用最大的10个文件：find / -type f -print0 | xargs -0 du -h | sort -rh | head -n 10**   
  上面的输出都是基于目录，如果我们想要查找文件单纯使用du无法使用，需要结合一下find，命令看起来比较复杂，也是面试经常会问到的  
  find / -type f：表示在/目录下查找文件类型     
  -print0：表示将null作为分隔符，而不是空格或换行符    
  xargs：是一个参数过滤器，-0表示用null分隔，这里相当于把find的结果通过null分隔得到结果，然后传给du命令，后面的就和使用du命令一样了      
 
## 内存
**命令：free**   
参数介绍：  
 - h：内存显示会自动适配单位，内存使用适配单位来显示（带单位，常用）。
 - g：内存显示会适配GB单位，内存使用GB来显示。
 - m：内存显示会适配MB单位，内存使用用MB来显示。
 - k：内存显示会适配kb单位，内存使用用kb来显示(默认显示)。
 - b：内存显示会适配字节单位，内存使用用字节来显示。
 - s：刷新的时间，单位秒。输出结果是累加后面的。
 - t：会增加一行显示系统总内存/使用/剩余  
**例如：我们输入 free -h -s 1(一秒刷新内存使用情况)**
![image](https://github.com/jmilktea/jmilktea/blob/master/linux/images/free.png)
 - Mem：当前系统内存的使用情况。
 - Swap：交换空间（虚拟内存，硬盘当内存使用）的使用情况。解释：当物理内存不够使用，系统会开辟硬盘空间来当系统内存使用（windows也有）。经常不使用的进程就会从物理内存挪到swap中。如果该进程重新唤醒的时候，又会重新加载到物理内存中。当物理内存充足，swap空间大小是 0
 - total：系统的物理内存大小/交换空间内存大小
 - used：已使用物理内存大小/交换空间内存大小
 - free：剩余物理内存大小/交换空间内存大小。可以理解空闲内存，未开发的内存。并不是当前系统可用内存
 - shared：多个进程共享的内存总额
 - buff/cache；buffer和cache使用的物理内存大小。
 - available：还可以被应用程序使用的物理内存大小(内存已经被系统征用)  
**想跟top那样持续更新内存信息可以使用命令：watch free -k**
**free命令输出的信息来源于 cat /proc/meminfo 文件，这个文件存储了系统资源使用情况**
  
  ## docker容器查看内存使用情况
**docke容器运行在docker中。但是所有的容器共享内核。每个容器在系统中对应一个进程。找出对于的进程即可查看内存使用情况**
![image](https://github.com/jmilktea/jmilktea/blob/master/linux/images/docker-ps.png)
**docker stats命令。这个命令有点像top的味道。也是不停的在刷新（1S）内存CPU使用情况**
![image](https://github.com/jmilktea/jmilktea/blob/master/linux/images/docker-stats.png)
信息介绍：
 - CONTAINER：容器id.
 - NAME：容器名称
 - CPU%：CPU使用情况
 - MEM USAGE / LIMIT：当前使用内存/最大使用内存（无设置则是系统最大内存）
 - MEM %：百分比显示内存。上面两个参数相除
 - NET I/O：网络IO
 - BOLCK I/O；磁盘IO
 - PIDS：PID 号 
命令介绍：
 - no-stream：无须持续刷新
 - 容器ID：只查看想看的容器。输入容器ID即可。多个容器id空格隔开
 
## 进程
**命令：ps，查看系统进程，使用 BS 操作系统格式**   
参数介绍：  
 - a：显示一个终端的所有进程，除会话进线外
 - u：显示进程的归属用户及内存的使用情况
 - x：显示没有控制终端的进程
 - l：长格式显示更加详细的信息
 - e：显示所有进程  
**例如：我们经常查询java的运行情况：ps aux |grep java**
![image](https://github.com/jmilktea/jmilktea/blob/master/linux/images/ps.png)
以上是ps aux列出所有进程其中：
 - user：进程运行的用户
 - PID：进程的ID
 - %CPU：当前使用的CPU百分比
 - MEM：该进程占用物理内存的百分比，占用的百分比越高，进程越耗费资源
 - VSZ：该进程占用虚拟内存的大小，单位为 KB。
 - RSS：该进程占用实际物理内存的大小，单位为 KB。
 - TTY：该进程是在哪个终端运行的
 - STAT：进程状态.S
 - START：该进程的启动时间
 - TIME：该进程占用 CPU 的运算时间，注意不是系统时间
 - COMMAND：该进程启动的shell命令  
**其中 | 是linux的缓存区管道，前面命令产生的输出流通过管道进入 grep命令进行分组。**
**筛选出含有java的进程。（一般搜索启动命令COMMAND）就可以快速找到我们想要的进程**
